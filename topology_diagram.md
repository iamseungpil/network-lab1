# Diamond Topology 구조 및 경로 분석

## 기본 토폴로지 구조

```
        h1 (10.0.0.1)
            |
            | port 1
            |
        [Switch s1]
        /         \
    port 2      port 3
      /             \
     /               \
[Switch s2]      [Switch s3]
     |               |
  port 1          port 1
     |               |
h2 (10.0.0.2)   h3 (10.0.0.3)
     |               |
  port 3          port 3
     \               /
      \             /
    port 2      port 2
        \         /
        [Switch s4]
            |
         port 1
            |
        h4 (10.0.0.4)
```

## 상세 연결 정보

### 스위치 간 연결:
- **s1 ↔ s2**: s1:port2 ↔ s2:port3
- **s1 ↔ s3**: s1:port3 ↔ s3:port2
- **s2 ↔ s4**: s2:port2 ↔ s4:port3
- **s3 ↔ s4**: s3:port3 ↔ s4:port2

### 호스트 연결:
- **h1 ↔ s1**: h1:eth0 ↔ s1:port1
- **h2 ↔ s2**: h2:eth0 ↔ s2:port1
- **h3 ↔ s3**: h3:eth0 ↔ s3:port1
- **h4 ↔ s4**: h4:eth0 ↔ s4:port1

## 경로 분석

### 1. 정상 상태에서 h1 → h4 경로 (2가지 가능)

#### 경로 1 (상단 경로):
```
h1 → s1 → s2 → s4 → h4
```

#### 경로 2 (하단 경로):
```
h1 → s1 → s3 → s4 → h4
```

Dijkstra 알고리즘은 두 경로가 동일한 홉 수(3 hops)를 가지므로, 
먼저 발견된 경로를 선택합니다.

### 2. s1-s2 링크 다운 시 h1 → h4 경로

```
        h1 (10.0.0.1)
            |
        [Switch s1]
        /    ❌    \
       /  (DOWN)    \
      /              \
[Switch s2]      [Switch s3]
     |               |
h2 (10.0.0.2)   h3 (10.0.0.3)
     \               /
      \             /
        \         /
        [Switch s4]
            |
        h4 (10.0.0.4)
```

#### 유일한 가능 경로:
```
h1 → s1 → s3 → s4 → h4
```

**설명**: 
- s1-s2 링크가 다운되면 상단 경로가 차단됩니다
- 컨트롤러가 LLDP를 통해 링크 실패를 감지합니다
- Dijkstra 알고리즘이 재계산되어 하단 경로를 선택합니다
- s1 → s3 → s4 경로를 통해 h1과 h4가 연결됩니다

### 3. 링크 복구 시 동작

s1-s2 링크가 복구되면:
1. 컨트롤러가 링크 복구를 감지
2. 토폴로지 그래프 업데이트
3. 기존 플로우 테이블 초기화
4. 새로운 패킷이 오면 Dijkstra로 경로 재계산
5. 상단/하단 경로 중 하나를 다시 선택 가능

## 다중 링크 실패 시나리오

만약 s1-s2와 s1-s3 링크가 모두 다운되면:
```
        h1 (10.0.0.1)
            |
        [Switch s1]
        ❌       ❌
      (DOWN)   (DOWN)
         
[Switch s2]      [Switch s3]
     |               |
h2 (10.0.0.2)   h3 (10.0.0.3)
     \               /
      \             /
        \         /
        [Switch s4]
            |
        h4 (10.0.0.4)
```

이 경우 h1 → h4 연결이 불가능합니다 (s1이 고립됨).

## 핵심 포인트

1. **Diamond 토폴로지의 장점**: 
   - 이중화된 경로 제공
   - 단일 링크 실패 시 자동 복구 가능

2. **Dijkstra 알고리즘의 역할**:
   - 최단 경로 계산
   - 링크 비용이 동일하면 먼저 발견된 경로 선택

3. **SDN 컨트롤러의 동작**:
   - LLDP로 토폴로지 변화 감지
   - 실시간 경로 재계산
   - OpenFlow로 스위치 플로우 테이블 업데이트